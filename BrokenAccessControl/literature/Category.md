<!--
 * @Author: Suez_kip 287140262@qq.com
 * @Date: 2023-02-15 14:50:15
 * @LastEditTime: 2023-02-15 15:02:28
 * @LastEditors: Suez_kip
 * @Description: 
-->
# 越权访问

参考文献[REEBUF 逻辑漏洞之越权漏洞](https://m.freebuf.com/articles/web/324773.html)

越权访问（Broken Access Control，简称BAC）是Web应用程序中一种常见的漏洞，在实际的代码审计中，这种漏洞往往很难通过工具进行自动化监测，因此在实际应用中危害很大。

## 原理说明

如果使用A用户的权限去操作B用户的数据，A的权限小于B的权限，如果能够成功操作，则称之为越权操作。 越权漏洞形成的原因是后台使用了不合理的权限校验规则导致的。
一般越权漏洞容易出现在权限页面（需要登录的页面）增、删、改、查的的地方，当用户对权限页面内的信息进行这些操作时，后台需要对当前用户的权限进行校验，看其是否具备操作的权限，从而给出响应，而如果校验的规则过于简单则容易出现越权漏洞。
如果有waf的时候,优先考虑越权漏洞和逻辑漏洞

### 水平越权

权限类型不变，权限ID改变

水平越权访问是一种【基于数据的访问控制】设计缺陷引起的漏洞。由于服务器端在接收到请求数据进行操作时没有判断数据的所属人/所属部门而导致的越权数据访问漏洞。

水平越权测试方法：主要通过看看能否通过A用户操作影响到B用户

### 垂直越权

权限ID不变，权限类型改变

垂直越权是一种【基于URL的访问控制】设计缺陷引起的漏洞，又叫做权限提升攻击。

垂直越权测试思路：看看低权限用户是否能越权使用高权限用户的功能，比如普通用户可以使用管理员的功能。
先抓包高权限用户的某一操作，在抓包低权限用户包，将低权限用户cookie等复制到高权限包中，看能否完成同样的操作

### 真实案例

问题描述：测试过程中发现，用户在“地址管理”功能模块可越权查看任意收货信息，造成用户敏感信息泄露。在地址管理中，选择“修改”，此时用抓包工具截断GET请求：

```url
http://www.XXXX.cn/index.php?app=treasure&mod=Order&act=findId&address_id=1111
```

将address_id参数值替换为任意数值如2222,提交后发现返回了对应用户的收货信息

### 越权漏洞突破思路

1. 一般管理页面可能存在越权漏洞
如果是白盒测试的话
找到admin相关 需要管理员账号才可以访问的文件
针对于前端绕过 访问该目录，可能会有一个js拦截，我们利用浏览器隐私安全性设置找到javascrip禁用 添加网站，再次进入可能会成功
针对于后端绕过
对于没有判断登录状态refer或者判断不标准，抓包修改为合法的refer就可以绕过
2. 有的对于用户管理的地方可能有，例如更改用户收货地址等
先用自己的账号登录，之后抓包，将id等改变一下，查看返回值验证
3. 有时候通过将cookie修改为他人的，也可以实现越权
4. 参数也可能有越权漏洞，例如订单编号等等
5. 注册过程中，输入已经注册过的邮箱，在相应信息中可能有返回信息的
6. 还有修改密码如果没有对手机号位数限制（数字位数，或者空格等特殊符号）也可能有漏洞

## 越权漏洞的发生位置分类

1. 修改Get传参的越权漏洞；
2. 修改Post传参的越权漏洞；
3. 修改Cookie传参的越权漏洞；
4. 组合验证和传参中实现的越权漏洞；
5. 未授权访问(严格意义上不属于越权漏洞)

未授权访问是指用户在没有通过认证授权的情况下就能够直接访问需要通过认证才能访问到的页面或文本信息，比如直接对该系统的各个接口实现未授权访问，但其实这个类型的漏洞高危但并不是十分有研究意义；

### 越权的防御

这些也可以作为漏洞检测的方案：

1. 对于涉及用户唯一信息的请求，每次都要验证和检查所有权；

2. 敏感信息页面加随机数的参数，防止浏览器缓存内容；

3. 不使用暴露给用户的参数来做权限与身份得区分标识；

4. 将权限与功能对应，使用最小权限原则，普通用户授予能正常使用基本功能的最小权限；
