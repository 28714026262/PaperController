<!--
 * @Author: Suez_kip 287140262@qq.com
 * @Date: 2022-10-18 19:43:22
 * @LastEditTime: 2022-10-24 13:54:34
 * @LastEditors: Suez_kip
 * @Description: 
-->
# AI 代码漏洞检测

代码分析技术是漏洞检测的基础，可以分为静态、动态和混合方法。

## 静态技术

基于规则模板的分析、代码相似性检测和符号执行，主要依赖于对源代码的分析，但往往存在较高的误报率。

## AI

使用模式识别和机器学习（ML）的数据驱动漏洞发现，
具有显著提高泛化水平的潜力。
现有的基于ML的方法主要操作源代码，有高可读性。
研究人员应用了基于源代码的功能（潜在脆弱文件或代码片段的指标）：

- 导入（例如头文件）
- 函数调用
- 软件复杂性度量
- 代码更改

从版本控制系统获得的特性和信息：

- 代码提交
- 开发人员活动  
  
**任务目标：**：缩小语义鸿沟（语义鸿沟是指从业者可以理解的漏洞抽象语义与ML算法可以学习的获得语义之间缺乏一致性）  
  
### 传统ML

专家定义特征取决于人类经验、专业知识水平和领域知识的深度，特征工程过程可能很耗时，并且可能容易出错。如早期根据最佳编程实践提取规则模板&抽象语法树（AST）和控制流图（CFG）；系统从特征集中学习到的内容也可能受到各种因素的影响（例如，模型的表达能力、数据过拟合、数据中的噪声等）  

**解决方案：**  
1)基于软件度量的方法;使用度量的漏洞检测模型建立在这样一个假设上:复杂的代码对于从业者来说很难理解，因此很难维护和测试。作为漏洞检测指标的代码流失指标意味着频繁修改的代码往往是错误的，因此更有可能是有缺陷的和可能是脆弱的；  
显然存在较大的假阳性概率，因此后续研究者会从源代码上下文中提取代码模式，使用词袋技术（bag-of-words based on N-gram），来仅仅统计术语、关联令牌等代码特征共出现的计数，但不能保留代码的长期上下文依赖性；  
相较于上述扁平化代码分析，现在会使用高纬度特征集，这些特征集是从静态分析生成的不同形式的程序表示中提取出来的，包括ast、cfg、数据流图(dgs)、程序依赖图(PDGs)等。将AST、CFG和PDG组合成一种称为代码属性图(CPG)的联合表征，而从动态分析中获得的程序执行轨迹也被用作特征；  
2)基于脆弱代码模式与3)基于异常：  
脆弱的代码模式是偏离正确和正常的代码模式的异常模式，异常状态包括：***异常API使用模式[6]、导入和函数调用[73]以及API符号缺失检查***
导致许多假阳性或只适用于特定任务的应用程序

### 新兴ML

抽象和高度非线性模式的学习，能够捕获复杂数据的内在结构。自动提取特征，并且具有多个抽象级别，并且可能具有更高的泛化级别以及发现未考虑过的潜在特征；该类方案目标是使基于ML的检测系统最终能够像人类一样学习和理解易受攻击的代码语义，用以进一步减少语义差距。  
如RNN，将长短期记忆(LSTM)网络与密集层结合起来，用于学习函数级表示作为高级特征，实现注意层以学习特征重要性，并添加外部内存“插槽”以捕获远程代码依赖；  

#### 常见架构类型

*FCN*  
    FCN也被称为多层感知器（MLP），与随机森林、支持向量机(SVM)和C4.5等传统的ML算法相比，FCN能够拟合高度非线性和抽象的模式，通用逼近定理[23]所支持的，一个具有单一隐层和有限数量神经元的FCN可以近似任何连续函数。FCN的另一个优点是它是“输入结构不可知的”，这意味着网络可以采用多种形式的输入数据；  

*CNN*  
    在文本分类任务中，应用于上下文窗口(即包含少量单词嵌入)的CNN过滤器可以将上下文窗口中的单词投影到上下文特征空间中的局部上下文特征向量上，其中语义相似的单词向量非常接近。  

*RNN*  
    ![图 2](images/0097230d823dbfc35731cb14c74000187a55c76ceb692ae0344c3aad42976d1b.png)  
    ![图 3](images/be71d363d49f35030983b65f0943ec844b2bdaad5c4182bed5a71ee0383116b3.png)  
    双向形式的rnn能够捕获序列的长期依赖性。许多研究利用双向LSTM (Bi-LSTM)和门通循环单元(GRU)结构来学习代码上下文依赖关系，这对于理解许多类型漏洞(例如缓冲区溢出漏洞)的语义至关重要。

*Other*  
    一些网络结构不适合上述类型，如深度信念网络(DBN)和变分自编码器(VAEs)；  
DBN：  
    假设有一个二部图，每一层的节点之间没有链接，一层是可视层，即输入数据层（v)，一层是隐藏层(h)，如果假设所有的节点都是随机二值变量节点（只能取0或者1值），同时假设全概率分布p(v,h)满足Boltzmann 分布，我们称这个模型是Restricted BoltzmannMachine (RBM)。在已知v的情况下，所有的隐藏节点之间是条件独立的，同理所有的可视节点都是条件独立的，所有的v和h满足Boltzmann 分布；我们把隐藏层的层数增加，我们可以得到Deep Boltzmann Machine(DBM)；  
    ![图 5](images/7f99fb00439dd94f2939f56a3bcdd8decc10a0b65896510b05cdc1ed8674430e.png)  
    ![图 6](images/6c8bdcec7909a849c6eb53c3add6071b44b6e2d561882fc2b6a6397ab6dee18e.png)  

VAEs：
    ![图 7](images/f37d3523afe1d4da9947ade6be47e1bf1c71e2ea372b9afeb2b04b4a001c0503.png)  

记忆网络：  
    该网络配备了外部内存“插槽”，用于存储之前引入的信息，以供未来访问。与LSTM结构相比，该网络能够捕获更远距离的序列相关性;因此，它增强了捕获范围更广的代码序列的能力，这些代码序列是识别依赖于上下文的缓冲区溢出漏洞的关键；  

#### 研究现状

1)基于图的特征表示:大量研究应用dnn从不同类型的基于图的程序表示中学习特征表示，包括AST、2、CFG、PDG和它们的组合。  
2)基于序列的特征表示:这类研究利用dnn从序列代码实体中提取特征表示，如执行跟踪、函数调用序列和变量流/序列。  
3)基于文本的特征表示:对于这类作品，特征表示直接从代码的表面文本中学习。  
4)混合特征表示:这一类包括最近结合上述三种类型的特征表示的研究。  
***Target***
Ⅰ如何处理软件代码以生成特征表示->促进DNN对代码语义的理解，并将模式捕获为潜在脆弱代码片段的指示器；  
ⅡDNN模型用作具有内置表示学习能力的分类器;  

## 动态分析

包括模糊测试和污点分析，通常存在代码覆盖率低的问题。

## 混合方法

结合了静态和动态分析技术，旨在克服上述缺点。
