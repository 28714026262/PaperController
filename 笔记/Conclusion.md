<!--
 * @Author: Suez_kip 287140262@qq.com
 * @Date: 2022-11-30 14:18:45
 * @LastEditTime: 2022-12-03 20:58:00
 * @LastEditors: Suez_kip
 * @Description: Conclusion
-->
# AI Vulnerability detector

***持续更新***  
针对技术漏洞，安全代码漏洞检测主要可以分为以下几个部分

- 代码相似性
- 漏洞相似性
- 代码修改、版本迭代、复杂度等脆弱性指标

其中代码相似性，可以分为：

- 依靠分类器技术的检测方法；
- 单纯依靠代码相似度实现聚类、二元相似等方案的；

## 基本步骤

### I 数据集获取

- RealWorld：FFmpeg, LibTIFF, LibPNG, Pidgin, VLC media player, and Asterisk；devign文章中有一套还行的现实数据集
- Human made：SARD；

### II 代码预处理

为了降低来自不同代码编写规律带来的代码差异度，一般可以对代码进行以下预处理：

1. 冗余字段删除，不影响编译和程序具体内容的语句进行修剪；
2. 调用删除；在一定层数、函数大小、是否为库函数的范围内进行调用的搬运，将多函数间复杂的调用关系调整为单一函数，这一步在预处理中时很容易理解的；由于高结构性，AI训练非常难以理解，但预处理中非常轻松
3. 定义名归一化，一般在同一函数内进行修正，这样能降低码本空间，提高检测精度，但可能在需要考虑代码行为级别时丢失一定的语义信息，甚至可以对相同类型常数进行归一化；

### III I 代码嵌入

代码嵌入用于适应AI模型的输入，追求的是将语义尽可能地还原，以提高检测准确率；  
由于AI一般只能接受的形式是序列或者矩阵，因此会对代码进行序列化、矩阵化嵌入；  

一般为了表示代码的结构性，一般会将代码进行图表示，其中可以并需要包含以下信息：  

1. 单个节点信息，根据节点粒度方案可以分为：
   1. 数据节点：数据的类型、大小以及所属的抽象对象；
   2. 语句节点（常用）：语句的行为分类，是否调用了（敏感）库函数等；
   3. 代码块节点：代码块的输入输出以及内部的抽象操作等语义信息；
2. 图的结构信息，这里较为抽象，将节点上的信息完全抹除；
3. 数据依赖信息；
4. 控制依赖信息；
5. 基于行为敏感性的注意力机制；

为了表示以上的信息内容，所使用的代码表示技术：

1. AST（利用island grammar提取等）；
2. CFG；
3. DFG；
4. ACFG；
5. SDG，PDG；
6. FUNDED的丰富AST；
7. NCS（少见）；

在完成代码抽象化后，就需要进行代码流提取：

1. 直接将一段代码转化为扁平化的序列；需要填充或切割至等长；
2. 基于code gadget思维，以敏感点为中心，对相关流进行提取，可进行上行流提取、下行流提取以及上下行流同时提取；需要填充或切割至等长；敏感点提取策略：
   1. 专家手动获取；
   2. 基于API/库调用；
   3. 基于diff文件（用于bug修复）的词频分析；
3. 基于代码游走的策略提取：
   1. 对多粒度节点形成的多特征图的特定概率游走（struc2vec）；
   2. 线性独立的随机游走；
   3. 深度遍历；
   4. 广度遍历；
4. hash（稀有）；
5. 基于先验的专家经验直接提取，例如污点传播路径；

代码流嵌入：

- 序列的嵌入，如skip-gram；
- 节点的word2vec、CBOW等，然后进行拼接，这个需要考虑OOV（out of  vacabulary）问题；

其他嵌入：

- struc2vec
- structure2vec
- ASM2vec
- node2vec
- word2vec
- code2vec

- commit2vec？？？

### III II 其余语义信息获取

注意力机制：

1. 基于漏洞点与上下文窗口的扁平注意力机制（weight仅分为0，1）；
2. 基于漏洞点距离的负相关的加权注意力机制；
3. 基于不同操作行为的注意力机制；

### IV-I 训练分类器模型

由于输入形式包括定长序列或者嵌入生成的矩阵，因此分别常用：

- Bi-LSTM：基于长序列记忆性质，保证模型能够兼顾一定的语义信息来判断漏洞存在性；
- 图神经网络
- memery net；
- CNN；

### IV-II 相似性获取

相似性可以根据以下几种方案来获取相似性：

- 使用hash后的lsh查询；
- 使用LCS最长公共子序列探查，实现块相似转化为序列相似性检查；
- 基于孪生神经网络（一般是LSTM）来实现对目标代码块、代码序列实现无解释性嵌入后，使用余弦距离等实现二元相似性获取；

### 其他漏洞获取探索方案

- 基于query的文本问答任务的

## 漏洞分类与数据来源

技术漏洞根据迁移的变化性可以分为四级，越低级的漏洞就越适合AI的探索，但更弱：

1. 直接clone；
2. 变量变换下的clone；
3. 结构变换的clone；
4. 语义相同的clone；

数据集一般分为：

1. 自动生成：
   1. SARD数据集（常用）；
   2. juliet；
   3. CVE保有数据；
   4. 自动生成的缓冲区溢出的方案；、
2. 真实数据集：
   1. 基于补丁的信息收集；
   2. 基于同一源代码的异性架构二进制、汇编生成；

收集方式：

- 基于模型准确率的专家委员会机制的漏洞自动收集系统（FUNDED）

## bench-mark

- Machine-Learning Supported Vulnerability Detection in Source Code
- 基于前k%的易受攻击测试用例进行回归以及准确度的计算(Benchmark:Deep Learning-Based Vulnerable)
