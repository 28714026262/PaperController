<!--
 * @Author: Suez_kip 287140262@qq.com
 * @Date: 2023-09-13 17:05:09
 * @LastEditTime: 2023-09-13 17:36:54
 * @LastEditors: Suez_kip
 * @Description: 
-->
# CAN总线调研

Controller Area Network，是 ISO 国际标准化的串行通信协议。CAN总线有两个ISO国际标准：

- ISO11898 定义了通信速率为 125 kbps～1 Mbps 的高速 CAN 通信标准，属于闭环总线，传输速率可达1Mbps，总线长度 ≤ 40米.
- ISO11519 定义了通信速率为 10～125 kbps 的低速 CAN 通信标准，属于开环总线，传输速率为40kbps时，总线长度可达1000米。

左边是高速CAN总线的拓扑结构，右边是低速CAN总线的拓扑结构：

![图 0](../images2/c08282369ffecbc5a8e0d107cd28c93f354f5de8d5b70da4ddab42f4dd099800.png)  

节点通过CAN控制器和CAN收发器连接到CAN总线上，利用CAN_H和CAN_L两根线上的电位差来表示CAN信号，电位差分为显性电平和隐性电平。其中显性电平为逻辑0，隐性电平为逻辑1。

![图 1](../images2/1d774abeeb397cdb4a93902d56c9470e1e9f8d3966007f245d624316e7669eb8.png)  
![图 2](../images2/313a1e4c96c19fa28bd5f2c9aebecad94a51631ffad9b246de50c68d9d086ba1.png)  
![图 3](../images2/d73d13086655e8abc0f4d66a46cd3c13158742d7d50d1fe2d827aef5c11c3941.png)  

## CAN通信的基本原理

### 多主工作方式

在总线空闲状态（当总线上出现连续的11位隐性电平，那么总线就处于空闲状态），任意节点都可以向总线上发送消息。

### 非破坏性仲裁机制

当多个节点同时向总线发送消息时，总线对各个消息的标识符（即ID号）进行逐位仲裁。如果某个节点发送的消息仲裁获胜，那么这个节点将获取总线的发送权，仲裁失败的节点则立即停止发送并转变为监听（接收）状态。既不会造成已发送数据的延迟，也不会破坏已经发送的数据；

### 系统的柔性

CAN总线上的节点没有“地址”的概念，因此在总线上增加节点时，不会对总线上已有节点的软硬件及应用层造成影响。

### 通信速度

在同一条CAN线上，所有节点的通信速度（位速率）必须相同，如果两条不同通信速度总线上的节点想要实现信息交互，必须通过网关。

### 数据传输方式

CAN总线可以实现一对一，一对多以及广播的数据传输方式，这依赖于验收滤波技术。验收滤波技术可以简单的理解为: Node_A 节点将需要接收的CAN报文的ID号记录下来，当Node_A在总线上侦听到一帧报文时, 它就会判断听到的这一帧报文的ID号是否在自己记录的ID号中，如果在，那么Node_A就接收该报文,否则就不管这一帧报文.

### 远程数据请求

某个节点Node_A可以通过发送“remote帧”到总线上的方式，请求某个节点Node_B来发送由该remote帧所指定的报文。

### 错误检测、错误通知、错误恢复功能

只要总线上发生了错误, 那么该总线上的所有节点都能发现这个错误；
检测出错误的节点会立即通知总线上其它所有的节点（错误通知功能）；
正在发送消息的节点，如果检测到错误，会立即停止当前的发送，并在同时不断地重复发送此消息，直到该消息发送成功为止（错误恢复功能）。

### 故障封闭

CAN总线上的节点能够判断错误的类型，能够判断是暂时性的错误（如噪声干扰）还是持续性的错误（如节点内部故障），如果判断是严重的持续性错误，那么节点就会切断自己与总线的联系，从而避免影响总线上其他节点的正常工作。
